{
  "entities": [
    { "id": "goblin", "tags": ["poisoned", "burning"], "properties": { "health": 50, "poisonStacks": 2, "burnStacks": 1 } }
  ],
  "rules": [
    {
      "from": "#poisoned",
      "where": {
        "filter": [
          { "var": "entities" },
          { ">": [{ "var": "properties.poisonStacks" }, 0] }
        ]
      },
      "do": {
        "mut": {
          "map": [
            { "var": "entities" },
            {
              "merge": [
                { "var": "" },
                {
                  "properties": {
                    "health": { "-": [{ "var": "properties.health" }, { "var": "properties.poisonStacks" }] }
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "from": "#burning",
      "where": {
        "filter": [
          { "var": "entities" },
          { ">": [{ "var": "properties.burnStacks" }, 0] }
        ]
      },
      "do": {
        "mut": {
          "map": [
            { "var": "entities" },
            {
              "merge": [
                { "var": "" },
                {
                  "properties": {
                    "health": { "-": [{ "var": "properties.health" }, { "*": [{ "var": "properties.burnStacks" }, 2] }] }
                  }
                }
              ]
            }
          ]
        }
      }
    }
  ]
}
